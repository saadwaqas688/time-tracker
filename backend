const express = require('express');
const app = express();
const bodyParser = require('body-parser');
const jwt = require('jsonwebtoken');

app.use(bodyParser.json()); // For parsing application/json

// Hardcoded project data

// Hardcoded project data
let projects = [
    {
        id: '1', // UUID.randomUUID().toString()
        name: 'Project waqas',
        tasks: [
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Inprogress',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Inprogress', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Review',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            },
            {
                id: '1',
                name: 'Task 1.1',
                description: 'Description for Task 1.1',
                createDate: '2024-07-23', // Example date
                status: 'Todo', // Default status
                timeSpent: '00:00:00' // Time spent
            },
            {
                id: '2',
                name: 'Task 1.2',
                description: 'Description for Task 1.2',
                createDate: '2024-07-23',
                status: 'Completed',
                timeSpent: '00:00:00'
            }
        ]
    },
    {
        id: '2', // UUID.randomUUID().toString()
        name: 'Project 2',
        tasks: [
            {
                id: '1',
                name: 'Task 2.1',
                description: 'Description for Task 2.1',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            },
            {
                id: '4',
                name: 'Task 2.2',
                description: 'Description for Task 2.2',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            },
            {
                id: '5',
                name: 'Task 2.3',
                description: 'Description for Task 2.3',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            }
        ]
    },
    {
        id: '3', // UUID.randomUUID().toString()
        name: 'Project 3',
        tasks: [
            {
                id: '6',
                name: 'Task 3.1',
                description: 'Description for Task 3.1',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            }
        ]
    },
    {
        id: '4', // UUID.randomUUID().toString()
        name: 'Project 4',
        tasks: [] // No tasks
    },
    {
        id: '5', // UUID.randomUUID().toString()
        name: 'Project 5',
        tasks: [
            {
                id: '7',
                name: 'Task 5.1',
                description: 'Description for Task 5.1',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            },
            {
                id: '8',
                name: 'Task 5.2',
                description: 'Description for Task 5.2',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            }
        ]
    },
    {
        id: '6', // UUID.randomUUID().toString()
        name: 'Project 6',
        tasks: [
            {
                id: '9',
                name: 'Task 6.1',
                description: 'Description for Task 6.1',
                createDate: '2024-07-23',
                status: 'Todo',
                timeSpent: '00:00:00'
            }
        ]
    }
];


const user = {
    id: '12345',
    email: 'user',
    name: 'John Doe',
    password: '123', // This should be hashed in a real application
    roles: ['USER'],
    selectedProjectId:'2',
    selectedTaskId:'1'

  };
  
  // Login endpoint
  app.post('/login', (req, res) => {
    const { email, password } = req.body;
  
    if (email === user.email && password === user.password) {
      // Generate a token (this should be a real JWT in a production environment)
      const token = jwt.sign({ id: user.id, email: user.email }, 'your_secret_key', { expiresIn: '1h' });
  
      res.json({
        success: true,
        user: {
          id: user.id,
          email: user.email,
          name: user.name,
          roles: user.roles,
          selectedProjectId:user.selectedProjectId,
          selectedTaskId:user.selectedTaskId,
          token: token
        }
      });
    } else {
      res.json({
        success: false,
        message: 'Invalid email or password.'
      });
    }
  });


// Endpoint to add a new project
app.post('/addProject', (req, res) => {
    const newProject = req.body;
 
    console.log('newProject',newProject)
    res.send('Project added successfully');
});


const tasks=[]

app.post('/addTask', (req, res) => {
    const newTask = req.body;

    // Validate the incoming task data
    if (!newTask || !newTask.projectId || !newTask.name || !newTask.description || !newTask.status) {
        return res.status(400).json({ error: 'Invalid task data' });
    }

    // Optionally, you can add additional validation or check if the task already exists

    // Add additional fields
    newTask.id = '8'; // This could be a generated unique ID or auto-incremented value
    newTask.createDate = new Date().toISOString().split('T')[0]; // Format as 'YYYY-MM-DD'
    newTask.timeSpent = '00:00:00'; // Default timeSpent

    // Add the new task to the tasks array (or your database)
    tasks.push(newTask);
    console.log('Added task:', newTask);

    res.status(201).json({ success: true, task:newTask });
});
// Endpoint to get all projects
app.get('/getProjects', (req, res) => {
    console.log('Getting projects:', projects);
    projects.forEach(project => {
    project.tasks.forEach(task => {
        task.projectId = project.id;
    });
});
    res.json(projects);
});

app.listen(3000, () => {
    console.log('Server is running on port 3000');
});